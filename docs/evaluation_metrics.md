# 一、开环评测指标

| 模块             | 指标              | 全称                            | 含义                                                           | 计算方法                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| :-------------- | :---------------: | :-----------------------------: | :------------------------------------------------------------: | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Motion         | ADE             | Average Displacement Error    | 在预测轨迹和真实轨迹之间，平均点对点L2距离；ADE 值越小，说明预测轨迹与真实轨迹在位置上的偏差越小，预测的准确性越高 | $ADE=\frac{1}{T}\sum_{t=1}^T\|\hat{p}_t-p_t\|_2$<br>其中：<br>$\hat{p}_t$表示在时间步$t$的预测位置<br>$p_t$表示在时间步$t$的真实位置<br>$T$是总的时间步数<br>$\|·\|_2$表示欧氏距离计算                                                                                                                                                                                                                                                                                                                 |
|                | FDE             | Final Displacement Error      | 预测的最终点和真实轨迹的最终点之间的L2距离                                       | $FDE=\|\hat{p}_T-p_T\|_2$<br>其中：<br>$\hat{p}_T$表示在最后时间步$T$的预测位置<br>$p_t$表示在最后时间步$T$的真实位置<br>$T$是总的时间步数<br>$\|·\|_2$表示欧氏距离计算                                                                                                                                                                                                                                                                                                                                    |
|                | MR              | Miss Rate                     | 如果预测和真实轨迹之间的最大的点对点L2距离超过2米，则定义这个预测为miss                      | $Miss Rate=\frac{miss的轨迹数量}{总的预测轨迹的数量}$                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                | EPA             | Effective Prediction Accuracy | 综合考虑了检测和轨迹预测的性能。值域在-0.5到1之间。EPA越高,表示模型的整体性能越好                | $EPA =\frac{ (N\_det\_traj\_tp - 0.5 * N\_det\_fp) }{ (N\_det\_gt + 1e-5) }$<br>其中:<br>`N_det_traj_tp`: 轨迹预测的真正例(True Positive)数量<br>`N_det_fp`: 检测的假正例(False Positive)数量<br>`N_det_gt`: 真实标注(Ground Truth)的数量                                                                                                                                                                                                                                                 |
| Planning       | plan_L2_1s      | Planning L2 Distance_1s       | 未来1s时，预测轨迹与真实轨迹的L2距离                                         | $ADE=\frac{1}{T}\sum_{t=0}^T\|\hat{p}_t-p_t\|_2$<br>其中：<br>$\hat{p}_t$表示在时间步$t$的预测位置<br>$p_t$表示在时间步$t$的真实位置<br>$T=1$<br>$\|·\|_2$表示欧氏距离计算                                                                                                                                                                                                                                                                                                                      |
|                | plan_L2_2s      | Planning L2 Distance_2s       | 未来2s时，预测轨迹与真实轨迹的L2距离                                         | $ADE=\frac{1}{T}\sum_{t=0}^T\|\hat{p}_t-p_t\|_2$<br>其中：<br>$\hat{p}_t$表示在时间步$t$的预测位置<br>$p_t$表示在时间步$t$的真实位置<br>$T=2$<br>$\|·\|_2$表示欧氏距离计算                                                                                                                                                                                                                                                                                                                      |
|                | plan_L2_3s      | Planning L2 Distance_3s       | 未来3s时，预测轨迹与真实轨迹的L2距离                                         | $ADE=\frac{1}{T}\sum_{t=0}^T\|\hat{p}_t-p_t\|_2$<br>其中：<br>$\hat{p}_t$表示在时间步$t$的预测位置<br>$p_t$表示在时间步$t$的真实位置<br>$T=3$<br>$\|·\|_2$表示欧氏距离计算                                                                                                                                                                                                                                                                                                                      |
|                | plan_obj_col_1s | Planning Object Collision_1s  | 未来1s时发生碰撞的概率                                                 | 通常使用GJK（Gilbert–Johnson–Keerthi）算法检测两个凸集是否重叠，即检查车辆的包围盒和物体的包围盒是否重叠。假设1s有10个时间步，其中3个时间步检测到了碰撞，则碰撞概率为30%                                                                                                                                                                                                                                                                                                                                                          |
|                | plan_obj_col_2s | Planning Object Collision_2s  | 未来2s时发生碰撞的概率                                                 | 同上                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|                | plan_obj_col_3s | Planning Object Collision_3s  | 未来3s时发生碰撞的概率                                                 | 同上                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Detection      | AP              | Average Precision             | 目标检测的平均精度                                                    | 1. 计算Precision和Recall<br>一个目标检测任务中有$N$个真实目标，检测算法给出了$M$个检测结果<br>对于每个检测结果，计算检测框与真实目标框的交并比 IoU 来确定检测结果是否与真实目标匹配<br>令$TP(TruePositives)$表示正确检测到的目标数量，$FP(False Positives)$表示错误检测到的目标数量<br>$Precision = \frac{TP}{TP+FP}$<br>$Recall=\frac{TP}{N}$<br>2. 绘制Precision-Recall 曲线：<br>按照检测结果的置信度从高到低遍历，在不同的置信度阈值下计算$Precision$和$Recall$，得到一系列点 <br>以$Recall$为横坐标，$Precision$为纵坐标，绘制$Precision-Recall$曲线<br>3. 最后计算平均精度$(Average Precision)$：对$Precision-Recall$ 曲线进行积分 |
|                | ATE             | Average Transiation Error     | 检测到的目标位置与真实目标位置的平均平移误差                                       | $ATE=\frac{1}{N}\sum_{i=1}^N\|\hat{p}_i-p_i\|_2$<br>其中：<br>$\hat{p}_i$表示第$i$个目标的预测位置<br>$p_i$表示第$i$个目标的真实位置                                                                                                                                                                                                                                                                                                                                                    |
|                | ASE             | Average Scale Error           | 检测到的目标与真实目标的平均缩放误差                                           | $ASE=1-IoU$                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|                | AOE             | Average Orient Error          | 预测目标的方向（yaw角）与真实目标方向的平均旋转误差                                  | $\mathrm{AOE}=\min(\|\theta_{\mathrm{pred}}-\theta_{\mathrm{gt}}\|,360^\circ-\|\theta_{\mathrm{pred}}-\theta_{\mathrm{gt}}\|)$<br>其中：<br>$\theta_{pred}$是预测目标的方向角度<br>$\theta_{gt}$是真实目标的方向角度<br>$\|\theta_{pred}-\theta_{gt}\|$是预测目标角度和真实目标角度之间的绝对差值<br><br>                                                                                                                                                                                                  |
|                | AVE             | Average Velocity Error        | 预测目标的速度与真实目标的平均速度误差                                          | $\mathrm A\mathrm V\mathrm E=\frac{1}{N}\sum_{i=1}^N\left\|\mathbf v_{\mathrm pred,i}-\mathbf v_{\mathrm g\mathrm t,i}\right\|_2$<br>其中：<br>$N$是检测目标的总数<br>$\mathbf v_{\mathrm pred,i}$是第$i$个目标的预测速度向量<br>$\mathbf v_{\mathrm gt,i}$是第$i$个目标的真实速度向量<br>$\|·\|_2$表示欧氏距离计算<br>                                                                                                                                                                                   |
|                | AAE             | Average Attribute Error       | 预测目标与真实目标的平均属性误差                                             | $AAE=\frac{1}{N}\sum_{i=1}^{N}\|a_{i}^{pred}-a_{i}^{gt}\|$<br>其中：<br>$a_{i}^{pred}$是第$i$个目标的预测属性<br>$a_{i}^{gt}$d第$i$个目标的真实属性                                                                                                                                                                                                                                                                                                                                  |
|                | NDS             | nuScenes Detection Score      | nuScenes数据集的官方评估指标，全面评估目标检测算法的性能                             | $\mathrm{NDS=\frac{1}{2}\times mAP+\frac{1}{2}\times\left(\frac{mATE+mASE+mAOE+mAVE+mAAE}{5}\right)}$                                                                                                                                                                                                                                                                                                                                                          |
| Map Prediction | mAP@0.5         | Mean Average Precision        | 阈值为0.5m时，地图预测的平均精度均值                                         | 计算方法同Detection的mAP计算方法                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|                | mAP@1           | Mean Average Precision        | 阈值为1m时，地图预测的平均精度均值                                           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|                | mAP@1.5         | Mean Average Precision        | 阈值为1.5m时，地图预测的平均精度均值                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|                | mAP             | Mean Average Precision        | 上述3种阈值下的mAP的均值                                               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
